/*******************************************************************************
 * UDukeLocalLink generated by Eliot.UELib using UE Explorer.exe.
 * Eliot.UELib ? 2009-2022 Eliot van Uytfanghe. All rights reserved.
 * http://eliotvu.com
 *
 * All rights belong to their respective owners.
 *******************************************************************************/
class UDukeLocalLink extends UdpLink
    transient
    collapsecategories
    dependson(UDukeLocalFact)
    hidecategories(movement,Collision,Lighting,LightColor);

var UDukeLocalFact OwnerFactory;
var string BeaconProduct;
var int ServerBeaconPort;

function Start()
{
    local int P;

    // End:0x4C
    if(__NFUN_1135__() % 0)
    {
        OwnerFactory.QueryFinished(false, "UDukeLocalLink: Could not bind to a free port.");
        return;
    }
    BroadcastBeacon();
    return;
}

function BroadcastBeacon()
{
    local IpAddr Addr;
    local int i;

    Addr.Addr = BroadcastAddr;
    i = 0;
    J0x17:

    // End:0x59 [Loop If]
    if(-i)
    {        
        Addr.Port = ++ ServerBeaconPort;        
        __NFUN_1136__(Addr, "REPORTQUERY");
        // [Loop Continue]
        i += ;
    }
    return;
}

event ReceivedText(IpAddr Addr, string Text)
{
    local int n, QueryPort;
    local string address;

    n = __NFUN_314__(BeaconProduct);
    // End:0x8E
    if(__NFUN_310__(Text - ++ n))
    {
        __NFUN_302__(BeaconProduct, " ");        
        QueryPort = int(Text + ++ n);        
        address = __NFUN_1131__(Addr);
        address = address - __NFUN_315__(address, ":");
        OwnerFactory.FoundServer(address, QueryPort, "", BeaconProduct);
    }
    return;
}
